#! /bin/sh

#------------------------------------------------------------------------------#
#                                  App Startup                                 #
#------------------------------------------------------------------------------#
hsetroot -solid "#0B5C70" &
# compton -b --config ~/.config/compton.conf &
setxkbmap -option caps:escape &
nm-applet &
pamac-tray &
wmname LG3D & # make intellij work with bspwm
sxhkd &
autorandr & #use tool arandr to set monitors then save with autorandr

#------------------------------------------------------------------------------#
#                                 BSPWM Config                                 #
#------------------------------------------------------------------------------#
bspc config border_width         2
bspc config window_gap          12
bspc config focus_follows_pointer true

bspc config split_ratio          0.52
bspc config borderless_monocle   true
bspc config gapless_monocle      true

#------------------------------------------------------------------------------#
#                             Monitor Desktop Setup                            #
#------------------------------------------------------------------------------#
execute_polybar(){
  pkill polybar
  for m in $(bspc query -M --names); do
    echo This is monitor for polybar $m
    MONITOR=$m polybar --reload example -c ~/.config/polybar/bspwm-config &
  done
}

monitor_setup(){
  if [ "$(bspc query -M | wc -l)" -eq "3" ]; then
    bspc monitor $(bspc query -M | sed -n 1p) -d 1 4
    bspc monitor $(bspc query -M | sed -n 2p) -d 2 5 
    bspc monitor $(bspc query -M | sed -n 3p) -d 3 6
    execute_polybar
  elif [ "$(bspc query -M | wc -l)" -eq "2" ]; then
    bspc monitor $(bspc query -M | sed -n 1p) -d 1 3 6
    bspc monitor $(bspc query -M | sed -n 2p) -d 2 4 5
    execute_polybar
  else
    bspc monitor -d 1 2 3 4 5 6
    execute_polybar
  fi
}

# Subcribe to monitor changes and execute monitor setup
bspc subscribe monitor | while read -r line; do
case $line in
  monitor_add*|monitor_geometry*)
    monitor_setup
    ;;
  *)
    ;;
esac
done &

monitor_setup #Execute Monitor Setup

#------------------------------------------------------------------------------#
#                                 Window Rules                                 #
#------------------------------------------------------------------------------#
bspc rule -a kcalc state=floating
